function PointNG(t){this.config=t,this.level=t.level,this.api_key=t.api_key,this.widgetPosition=t.widgetPosition,this.privacyPolicyLink=t.privacyPolicyLink}!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).brain=e()}(this,function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function r(t,e){return t(e={exports:{}},e.exports),e.exports}var n=function(t){return t&&t.Math==Math&&t},i=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")(),o=function(t){try{return!!t()}catch(t){return!0}},a=!o(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),u={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,c={f:s&&!u.call({1:2},1)?function(t){var e=s(this,t);return!!e&&e.enumerable}:u},l=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},h={}.toString,f=function(t){return h.call(t).slice(8,-1)},p="".split,y=o(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==f(t)?p.call(t,""):Object(t)}:Object,d=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},v=function(t){return y(d(t))},g=function(t){return"object"==typeof t?null!==t:"function"==typeof t},m=function(t,e){if(!g(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!g(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!g(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!g(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},b={}.hasOwnProperty,w=function(t,e){return b.call(t,e)},k=i.document,O=g(k)&&g(k.createElement),L=!a&&!o(function(){return 7!=Object.defineProperty((t="div",O?k.createElement(t):{}),"a",{get:function(){return 7}}).a;var t}),A=Object.getOwnPropertyDescriptor,T={f:a?A:function(t,e){if(t=v(t),e=m(e,!0),L)try{return A(t,e)}catch(t){}if(w(t,e))return l(!c.f.call(t,e),t[e])}},_=function(t){if(!g(t))throw TypeError(String(t)+" is not an object");return t},S=Object.defineProperty,E={f:a?S:function(t,e,r){if(_(t),e=m(e,!0),_(r),L)try{return S(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},P=a?function(t,e,r){return E.f(t,e,l(1,r))}:function(t,e,r){return t[e]=r,t},j=function(t,e){try{P(i,t,e)}catch(r){i[t]=e}return e},x=i["__core-js_shared__"]||j("__core-js_shared__",{}),I=Function.toString;"function"!=typeof x.inspectSource&&(x.inspectSource=function(t){return I.call(t)});var M,R,D,C=x.inspectSource,F=i.WeakMap,z="function"==typeof F&&/native code/.test(C(F)),N=r(function(t){(t.exports=function(t,e){return x[t]||(x[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})}),B=0,U=Math.random(),$=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++B+U).toString(36)},J=N("keys"),V=function(t){return J[t]||(J[t]=$(t))},W={},H=i.WeakMap;if(z){var q=new H,G=q.get,Y=q.has,K=q.set;M=function(t,e){return K.call(q,t,e),e},R=function(t){return G.call(q,t)||{}},D=function(t){return Y.call(q,t)}}else{var X=V("state");W[X]=!0,M=function(t,e){return P(t,X,e),e},R=function(t){return w(t,X)?t[X]:{}},D=function(t){return w(t,X)}}var Q,Z,tt={set:M,get:R,has:D,enforce:function(t){return D(t)?R(t):M(t,{})},getterFor:function(t){return function(e){var r;if(!g(e)||(r=R(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}},et=r(function(t){var e=tt.get,r=tt.enforce,n=String(String).split("String");(t.exports=function(t,e,o,a){var u=!!a&&!!a.unsafe,s=!!a&&!!a.enumerable,c=!!a&&!!a.noTargetGet;"function"==typeof o&&("string"!=typeof e||w(o,"name")||P(o,"name",e),r(o).source=n.join("string"==typeof e?e:"")),t!==i?(u?!c&&t[e]&&(s=!0):delete t[e],s?t[e]=o:P(t,e,o)):s?t[e]=o:j(e,o)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||C(this)})}),rt=i,nt=function(t){return"function"==typeof t?t:void 0},it=function(t,e){return arguments.length<2?nt(rt[t])||nt(i[t]):rt[t]&&rt[t][e]||i[t]&&i[t][e]},ot=Math.ceil,at=Math.floor,ut=function(t){return isNaN(t=+t)?0:(t>0?at:ot)(t)},st=Math.min,ct=function(t){return t>0?st(ut(t),9007199254740991):0},lt=Math.max,ht=Math.min,ft=function(t,e){var r=ut(t);return r<0?lt(r+e,0):ht(r,e)},pt=function(t){return function(e,r,n){var i,o=v(e),a=ct(o.length),u=ft(n,a);if(t&&r!=r){for(;a>u;)if((i=o[u++])!=i)return!0}else for(;a>u;u++)if((t||u in o)&&o[u]===r)return t||u||0;return!t&&-1}},yt={includes:pt(!0),indexOf:pt(!1)},dt=yt.indexOf,vt=function(t,e){var r,n=v(t),i=0,o=[];for(r in n)!w(W,r)&&w(n,r)&&o.push(r);for(;e.length>i;)w(n,r=e[i++])&&(~dt(o,r)||o.push(r));return o},gt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],mt=gt.concat("length","prototype"),bt={f:Object.getOwnPropertyNames||function(t){return vt(t,mt)}},wt=/#|\.prototype\./,kt=function(t,e){var r=Lt[Ot(t)];return r==Tt||r!=At&&("function"==typeof e?o(e):!!e)},Ot=kt.normalize=function(t){return String(t).replace(wt,".").toLowerCase()},Lt=kt.data={},At=kt.NATIVE="N",Tt=kt.POLYFILL="P",_t=kt,St=T.f,Et=function(t,e){var r,n,o,a,u,s=t.target,c=t.global,l=t.stat;if(r=c?i:l?i[s]||j(s,{}):(i[s]||{}).prototype)for(n in e){if(a=e[n],o=t.noTargetGet?(u=St(r,n))&&u.value:r[n],!_t(c?n:s+(l?".":"#")+n,t.forced)&&void 0!==o){if(typeof a==typeof o)continue;copyConstructorProperties(a,o)}(t.sham||o&&o.sham)&&P(a,"sham",!0),et(r,n,a,t)}},Pt=Array.isArray||function(t){return"Array"==f(t)},jt=function(t){return Object(d(t))},xt=!!Object.getOwnPropertySymbols&&!o(function(){return!String(Symbol())}),It=xt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Mt=N("wks"),Rt=i.Symbol,Dt=It?Rt:Rt&&Rt.withoutSetter||$,Ct=function(t){return w(Mt,t)||(xt&&w(Rt,t)?Mt[t]=Rt[t]:Mt[t]=Dt("Symbol."+t)),Mt[t]},Ft=Ct("species"),zt=function(t,e){var r;return Pt(t)&&("function"!=typeof(r=t.constructor)||r!==Array&&!Pt(r.prototype)?g(r)&&null===(r=r[Ft])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===e?0:e)},Nt=it("navigator","userAgent")||"",Bt=i.process,Ut=Bt&&Bt.versions,$t=Ut&&Ut.v8;$t?Z=(Q=$t.split("."))[0]+Q[1]:Nt&&(!(Q=Nt.match(/Edge\/(\d+)/))||Q[1]>=74)&&(Q=Nt.match(/Chrome\/(\d+)/))&&(Z=Q[1]);var Jt=Z&&+Z,Vt=Ct("species"),Wt=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Ht=[].push,qt=function(t){var e=1==t,r=2==t,n=3==t,i=4==t,o=6==t,a=5==t||o;return function(u,s,c,l){for(var h,f,p=jt(u),d=y(p),v=function(t,e,r){if(Wt(t),void 0===e)return t;switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,i){return t.call(e,r,n,i)}}return function(){return t.apply(e,arguments)}}(s,c,3),g=ct(d.length),m=0,b=l||zt,w=e?b(u,g):r?b(u,0):void 0;g>m;m++)if((a||m in d)&&(f=v(h=d[m],m,p),t))if(e)w[m]=f;else if(f)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:Ht.call(w,h)}else if(i)return!1;return o?-1:n||i?i:w}},Gt={forEach:qt(0),map:qt(1),filter:qt(2),some:qt(3),every:qt(4),find:qt(5),findIndex:qt(6)},Yt=function(t,e){var r=[][t];return!!r&&o(function(){r.call(null,e||function(){throw 1},1)})},Kt=Object.defineProperty,Xt={},Qt=function(t){throw t},Zt=function(t,e){if(w(Xt,t))return Xt[t];e||(e={});var r=[][t],n=!!w(e,"ACCESSORS")&&e.ACCESSORS,i=w(e,0)?e[0]:Qt,u=w(e,1)?e[1]:void 0;return Xt[t]=!!r&&!o(function(){if(n&&!a)return!0;var t={length:-1};n?Kt(t,1,{enumerable:!0,get:Qt}):t[1]=1,r.call(t,i,u)})},te=Gt.forEach,ee=Yt("forEach"),re=Zt("forEach"),ne=ee&&re?[].forEach:function(t){return te(this,t,arguments.length>1?arguments[1]:void 0)};Et({target:"Array",proto:!0,forced:[].forEach!=ne},{forEach:ne});var ie=function(t){return function(e,r,n,i){Wt(r);var o=jt(e),a=y(o),u=ct(o.length),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){i=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw TypeError("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(i=r(i,a[s],s,o));return i}},oe={left:ie(!1),right:ie(!0)},ae=Object.keys||function(t){return vt(t,gt)},ue=Object.assign,se=Object.defineProperty,ce=!ue||o(function(){if(a&&1!==ue({b:1},ue(se({},"a",{enumerable:!0,get:function(){se(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach(function(t){e[t]=t}),7!=ue({},t)[r]||"abcdefghijklmnopqrst"!=ae(ue({},e)).join("")})?function(t,e){for(var r=jt(t),n=arguments.length,i=1,o=objectGetOwnPropertySymbols.f,u=c.f;n>i;)for(var s,l=y(arguments[i++]),h=o?ae(l).concat(o(l)):ae(l),f=h.length,p=0;f>p;)s=h[p++],a&&!u.call(l,s)||(r[s]=l[s]);return r}:ue;Et({target:"Object",stat:!0,forced:Object.assign!==ce},{assign:ce});var le=o(function(){ae(1)});Et({target:"Object",stat:!0,forced:le},{keys:function(t){return ae(jt(t))}});for(var he in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var fe=i[he],pe=fe&&fe.prototype;if(pe&&pe.forEach!==ne)try{P(pe,"forEach",ne)}catch(t){pe.forEach=ne}}function ye(t){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function de(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ve(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ge(t,e,r){return e&&ve(t.prototype,e),r&&ve(t,r),t}function me(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function be(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function we(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?be(Object(r),!0).forEach(function(e){me(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}Et({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var ke,Oe=function(t){for(var e=jt(this),r=ct(e.length),n=arguments.length,i=ft(n>1?arguments[1]:void 0,r),o=n>2?arguments[2]:void 0,a=void 0===o?r:ft(o,r);a>i;)e[i++]=t;return e},Le=a?Object.defineProperties:function(t,e){_(t);for(var r,n=ae(e),i=n.length,o=0;i>o;)E.f(t,r=n[o++],e[r]);return t},Ae=(it("document","documentElement"),V("IE_PROTO")),Te=function(){},_e=function(){try{ke=document.domain&&new ActiveXObject("htmlfile")}catch(t){}_e=ke?function(t){t.write("<script><\/script>"),t.close();var e=t.parentWindow.Object;return t=null,e}(ke):NullProtoObjectViaIFrame();for(var t=gt.length;t--;)delete _e.prototype[gt[t]];return _e()};W[Ae]=!0;var Se=Object.create||function(t,e){var r;return null!==t?(Te.prototype=_(t),r=new Te,Te.prototype=null,r[Ae]=t):r=_e(),void 0===e?r:Le(r,e)},Ee=Ct("unscopables"),Pe=Array.prototype;null==Pe[Ee]&&E.f(Pe,Ee,{configurable:!0,value:Se(null)});var je=function(t){Pe[Ee][t]=!0};Et({target:"Array",proto:!0},{fill:Oe}),je("fill");var xe,Ie,Me,Re={},De=!o(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Ce=V("IE_PROTO"),Fe=Object.prototype,ze=De?Object.getPrototypeOf:function(t){return t=jt(t),w(t,Ce)?t[Ce]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Fe:null},Ne=Ct("iterator"),Be=!1;[].keys&&("next"in(Me=[].keys())?(Ie=ze(ze(Me)))!==Object.prototype&&(xe=Ie):Be=!0),null==xe&&(xe={}),w(xe,Ne)||P(xe,Ne,function(){return this});var Ue={IteratorPrototype:xe,BUGGY_SAFARI_ITERATORS:Be},$e=E.f,Je=Ct("toStringTag"),Ve=function(t,e,r){t&&!w(t=r?t:t.prototype,Je)&&$e(t,Je,{configurable:!0,value:e})},We=Ue.IteratorPrototype,He=function(){return this},qe=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return _(r),function(t){if(!g(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(n),e?t.call(r,n):r.__proto__=n,r}}():void 0),Ge=Ue.IteratorPrototype,Ye=Ue.BUGGY_SAFARI_ITERATORS,Ke=Ct("iterator"),Xe=function(){return this},Qe=tt.set,Ze=tt.getterFor("Array Iterator"),tr=function(t,e,r,n,i,o,a){!function(t,e,r){var n=e+" Iterator";t.prototype=Se(We,{next:l(1,r)}),Ve(t,n,!1),Re[n]=He}(r,e,n);var u,s,c,h=function(t){if(t===i&&v)return v;if(!Ye&&t in y)return y[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},f=e+" Iterator",p=!1,y=t.prototype,d=y[Ke]||y["@@iterator"]||i&&y[i],v=!Ye&&d||h(i),g="Array"==e&&y.entries||d;if(g&&(u=ze(g.call(new t)),Ge!==Object.prototype&&u.next&&(ze(u)!==Ge&&(qe?qe(u,Ge):"function"!=typeof u[Ke]&&P(u,Ke,Xe)),Ve(u,f,!0))),"values"==i&&d&&"values"!==d.name&&(p=!0,v=function(){return d.call(this)}),y[Ke]!==v&&P(y,Ke,v),Re[e]=v,i)if(s={values:h("values"),keys:o?v:h("keys"),entries:h("entries")},a)for(c in s)!Ye&&!p&&c in y||et(y,c,s[c]);else Et({target:e,proto:!0,forced:Ye||p},s);return s}(Array,"Array",function(t,e){Qe(this,{type:"Array Iterator",target:v(t),index:0,kind:e})},function(){var t=Ze(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:e[n],done:!1}:{value:[n,e[n]],done:!1}},"values");Re.Arguments=Re.Array,je("keys"),je("values"),je("entries");var er,rr=Gt.map,nr=(er="map",Jt>=51||!o(function(){var t=[];return(t.constructor={})[Vt]=function(){return{foo:1}},1!==t[er](Boolean).foo})),ir=Zt("map");Et({target:"Array",proto:!0,forced:!nr||!ir},{map:function(t){return rr(this,t,arguments.length>1?arguments[1]:void 0)}});var or="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,ar=function(t,e,r){for(var n in e)et(t,n,e[n],r);return t},ur=function(t,e,r){if(!(t instanceof e))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return t},sr=function(t){if(void 0===t)return 0;var e=ut(t),r=ct(e);if(e!==r)throw RangeError("Wrong length or index");return r},cr=(Math.abs,Math.pow,Math.floor,Math.log,Math.LN2,E.f,tt.get),lr=tt.set,hr=i.ArrayBuffer,fr=i.DataView,pr=fr&&fr.prototype,yr=Object.prototype,dr=i.RangeError;if(!or){hr=function(t){ur(this,hr,"ArrayBuffer");var e=sr(t);lr(this,{bytes:Oe.call(new Array(e),0),byteLength:e}),a||(this.byteLength=e)},fr=function(t,e,r){ur(this,fr,"DataView"),ur(t,hr,"DataView");var n=cr(t).byteLength,i=ut(e);if(i<0||i>n)throw dr("Wrong offset");if(i+(r=void 0===r?n-i:ct(r))>n)throw dr("Wrong length");lr(this,{buffer:t,byteLength:r,byteOffset:i}),a||(this.buffer=t,this.byteLength=r,this.byteOffset=i)},qe&&ze(pr)!==yr&&qe(pr,yr);var vr=new fr(new hr(2)),gr=pr.setInt8;vr.setInt8(0,2147483648),vr.setInt8(1,2147483649),!vr.getInt8(0)&&vr.getInt8(1)||ar(pr,{setInt8:function(t,e){gr.call(this,t,e<<24>>24)},setUint8:function(t,e){gr.call(this,t,e<<24>>24)}},{unsafe:!0})}Ve(hr,"ArrayBuffer"),Ve(fr,"DataView");var mr={ArrayBuffer:hr,DataView:fr},br=Ct("species"),wr=function(t,e){var r,n=_(t).constructor;return void 0===n||null==(r=_(n)[br])?e:Wt(r)},kr=mr.ArrayBuffer,Or=mr.DataView,Lr=kr.prototype.slice,Ar=o(function(){return!new kr(2).slice(1,void 0).byteLength});Et({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Ar},{slice:function(t,e){if(void 0!==Lr&&void 0===e)return Lr.call(_(this),t);for(var r=_(this).byteLength,n=ft(t,r),i=ft(void 0===e?r:e,r),o=new(wr(this,kr))(ct(i-n)),a=new Or(this),u=new Or(o),s=0;n<i;)u.setUint8(s++,a.getUint8(n++));return o}});var Tr={};Tr[Ct("toStringTag")]="z";var _r="[object z]"===String(Tr),Sr=Ct("toStringTag"),Er="Arguments"==f(function(){return arguments}()),Pr=_r?f:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Sr))?r:Er?f(e):"Object"==(n=f(e))&&"function"==typeof e.callee?"Arguments":n},jr=_r?{}.toString:function(){return"[object "+Pr(this)+"]"};_r||et(Object.prototype,"toString",jr,{unsafe:!0});var xr=Ct("iterator"),Ir=!1;try{var Mr=0,Rr={next:function(){return{done:!!Mr++}},return:function(){Ir=!0}};Rr[xr]=function(){return this},Array.from(Rr,function(){throw 2})}catch(t){}var Dr,Cr=function(t,e){if(!e&&!Ir)return!1;var r=!1;try{var n={};n[xr]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Fr=(E.f,i.Int8Array),zr=Fr&&Fr.prototype,Nr=i.Uint8ClampedArray,Br=(Nr&&Nr.prototype,Fr&&ze(Fr)),Ur=zr&&ze(zr),$r=Object.prototype.isPrototypeOf,Jr=(Ct("toStringTag"),$("TYPED_ARRAY_TAG"),or&&!!qe&&"Opera"!==Pr(i.opera)),Vr={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Wr=function(t){return g(t)&&w(Vr,Pr(t))};for(Dr in Vr)i[Dr]||(Jr=!1);if((!Jr||"function"!=typeof Br||Br===Function.prototype)&&(Br=function(){throw TypeError("Incorrect invocation")},Jr))for(Dr in Vr)i[Dr]&&qe(i[Dr],Br);var Hr={NATIVE_ARRAY_BUFFER_VIEWS:Jr,TYPED_ARRAY_TAG:!1,aTypedArray:function(t){if(Wr(t))return t;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(t){if(qe){if($r.call(Br,t))return t}else for(var e in Vr)if(w(Vr,Dr)){var r=i[e];if(r&&(t===r||$r.call(r,t)))return t}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r){if(a){if(r)for(var n in Vr){var o=i[n];o&&w(o.prototype,t)&&delete o.prototype[t]}Ur[t]&&!r||et(Ur,t,r?e:Jr&&zr[t]||e)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(a){if(qe){if(r)for(n in Vr)(o=i[n])&&w(o,t)&&delete o[t];if(Br[t]&&!r)return;try{return et(Br,t,r?e:Jr&&Fr[t]||e)}catch(t){}}for(n in Vr)!(o=i[n])||o[t]&&!r||et(o,t,e)}},isView:function(t){var e=Pr(t);return"DataView"===e||w(Vr,e)},isTypedArray:Wr,TypedArray:Br,TypedArrayPrototype:Ur},qr=Hr.NATIVE_ARRAY_BUFFER_VIEWS,Gr=i.ArrayBuffer,Yr=i.Int8Array,Kr=!qr||!o(function(){Yr(1)})||!o(function(){new Yr(-1)})||!Cr(function(t){new Yr,new Yr(null),new Yr(1.5),new Yr(t)},!0)||o(function(){return 1!==new Yr(new Gr(2),1,void 0).length}),Xr=Ct("species"),Qr=function(t){var e=it(t),r=E.f;a&&e&&!e[Xr]&&r(e,Xr,{configurable:!0,get:function(){return this}})};r(function(t){var e=bt.f,r=Gt.forEach,n=tt.get,o=tt.set,u=E.f,s=T.f,c=Math.round,h=i.RangeError,f=mr.ArrayBuffer,p=mr.DataView,y=Hr.NATIVE_ARRAY_BUFFER_VIEWS,d=Hr.TYPED_ARRAY_TAG,v=Hr.TypedArray,b=Hr.TypedArrayPrototype,k=Hr.aTypedArrayConstructor,O=Hr.isTypedArray,L=function(t,e){for(var r=0,n=e.length,i=new(k(t))(n);n>r;)i[r]=e[r++];return i},A=function(t,e){u(t,e,{get:function(){return n(this)[e]}})},_=function(t){var e;return t instanceof f||"ArrayBuffer"==(e=Pr(t))||"SharedArrayBuffer"==e},S=function(t,e){return O(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},j=function(t,e){return S(t,e=m(e,!0))?l(2,t[e]):s(t,e)},x=function(t,e,r){return!(S(t,e=m(e,!0))&&g(r)&&w(r,"value"))||w(r,"get")||w(r,"set")||r.configurable||w(r,"writable")&&!r.writable||w(r,"enumerable")&&!r.enumerable?u(t,e,r):(t[e]=r.value,t)};a?(y||(T.f=j,E.f=x,A(b,"buffer"),A(b,"byteOffset"),A(b,"byteLength"),A(b,"length")),Et({target:"Object",stat:!0,forced:!y},{getOwnPropertyDescriptor:j,defineProperty:x}),t.exports=function(t,a,s){var l=t.match(/\d+$/)[0]/8,m=t+(s?"Clamped":"")+"Array",w="get"+t,k="set"+t,A=i[m],T=A,S=T&&T.prototype,E={},j=function(t,e){u(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[w](e*l+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var i=n(t);s&&(r=(r=c(r))<0?0:r>255?255:255&r),i.view[k](e*l+i.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};y?Kr&&(T=a(function(t,e,r,n){return ur(t,T,m),inheritIfRequired(g(e)?_(e)?void 0!==n?new A(e,toOffset(r,l),n):void 0!==r?new A(e,toOffset(r,l)):new A(e):O(e)?L(T,e):typedArrayFrom.call(T,e):new A(sr(e)),t,T)}),qe&&qe(T,v),r(e(A),function(t){t in T||P(T,t,A[t])}),T.prototype=S):(T=a(function(t,e,r,n){ur(t,T,m);var i,a,u,s=0,c=0;if(g(e)){if(!_(e))return O(e)?L(T,e):typedArrayFrom.call(T,e);i=e,c=toOffset(r,l);var y=e.byteLength;if(void 0===n){if(y%l)throw h("Wrong length");if((a=y-c)<0)throw h("Wrong length")}else if((a=ct(n)*l)+c>y)throw h("Wrong length");u=a/l}else u=sr(e),i=new f(a=u*l);for(o(t,{buffer:i,byteOffset:c,byteLength:a,length:u,view:new p(i)});s<u;)j(t,s++)}),qe&&qe(T,v),S=T.prototype=Se(b)),S.constructor!==T&&P(S,"constructor",T),d&&P(S,d,m),E[m]=T,Et({global:!0,forced:T!=A,sham:!y},E),"BYTES_PER_ELEMENT"in T||P(T,"BYTES_PER_ELEMENT",l),"BYTES_PER_ELEMENT"in S||P(S,"BYTES_PER_ELEMENT",l),Qr(m)}):t.exports=function(){}})("Float32",function(t){return function(e,r,n){return t(this,e,r,n)}});var Zr=Math.min,tn=[].copyWithin||function(t,e){var r=jt(this),n=ct(r.length),i=ft(t,n),o=ft(e,n),a=arguments.length>2?arguments[2]:void 0,u=Zr((void 0===a?n:ft(a,n))-o,n-i),s=1;for(o<i&&i<o+u&&(s=-1,o+=u-1,i+=u-1);u-- >0;)o in r?r[i]=r[o]:delete r[i],i+=s,o+=s;return r},en=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("copyWithin",function(t,e){return tn.call(en(this),t,e,arguments.length>2?arguments[2]:void 0)});var rn=Gt.every,nn=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("every",function(t){return rn(nn(this),t,arguments.length>1?arguments[1]:void 0)});var on=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("fill",function(t){return Oe.apply(on(this),arguments)});var an=Gt.filter,un=Hr.aTypedArray,sn=Hr.aTypedArrayConstructor;(0,Hr.exportTypedArrayMethod)("filter",function(t){for(var e=an(un(this),t,arguments.length>1?arguments[1]:void 0),r=wr(this,this.constructor),n=0,i=e.length,o=new(sn(r))(i);i>n;)o[n]=e[n++];return o});var cn=Gt.find,ln=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("find",function(t){return cn(ln(this),t,arguments.length>1?arguments[1]:void 0)});var hn=Gt.findIndex,fn=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("findIndex",function(t){return hn(fn(this),t,arguments.length>1?arguments[1]:void 0)});var pn=Gt.forEach,yn=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("forEach",function(t){pn(yn(this),t,arguments.length>1?arguments[1]:void 0)});var dn=yt.includes,vn=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("includes",function(t){return dn(vn(this),t,arguments.length>1?arguments[1]:void 0)});var gn=yt.indexOf,mn=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("indexOf",function(t){return gn(mn(this),t,arguments.length>1?arguments[1]:void 0)});var bn=Ct("iterator"),wn=i.Uint8Array,kn=tr.values,On=tr.keys,Ln=tr.entries,An=Hr.aTypedArray,Tn=Hr.exportTypedArrayMethod,_n=wn&&wn.prototype[bn],Sn=!!_n&&("values"==_n.name||null==_n.name),En=function(){return kn.call(An(this))};Tn("entries",function(){return Ln.call(An(this))}),Tn("keys",function(){return On.call(An(this))}),Tn("values",En,!Sn),Tn(bn,En,!Sn);var Pn=Hr.aTypedArray,jn=[].join;(0,Hr.exportTypedArrayMethod)("join",function(t){return jn.apply(Pn(this),arguments)});var xn=Math.min,In=[].lastIndexOf,Mn=!!In&&1/[1].lastIndexOf(1,-0)<0,Rn=Yt("lastIndexOf"),Dn=Zt("indexOf",{ACCESSORS:!0,1:0}),Cn=Mn||!Rn||!Dn?function(t){if(Mn)return In.apply(this,arguments)||0;var e=v(this),r=ct(e.length),n=r-1;for(arguments.length>1&&(n=xn(n,ut(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:In,Fn=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("lastIndexOf",function(t){return Cn.apply(Fn(this),arguments)});var zn=Gt.map,Nn=Hr.aTypedArray,Bn=Hr.aTypedArrayConstructor;(0,Hr.exportTypedArrayMethod)("map",function(t){return zn(Nn(this),t,arguments.length>1?arguments[1]:void 0,function(t,e){return new(Bn(wr(t,t.constructor)))(e)})});var Un=oe.left,$n=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("reduce",function(t){return Un($n(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)});var Jn=oe.right,Vn=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("reduceRight",function(t){return Jn(Vn(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)});var Wn=Hr.aTypedArray,Hn=Hr.exportTypedArrayMethod,qn=Math.floor;Hn("reverse",function(){for(var t,e=Wn(this).length,r=qn(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this});var Gn=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("set",function(t){Gn(this);var e=toOffset(arguments.length>1?arguments[1]:void 0,1),r=this.length,n=jt(t),i=ct(n.length),o=0;if(i+e>r)throw RangeError("Wrong length");for(;o<i;)this[e+o]=n[o++]},o(function(){new Int8Array(1).set({})}));var Yn=Hr.aTypedArray,Kn=Hr.aTypedArrayConstructor,Xn=[].slice;(0,Hr.exportTypedArrayMethod)("slice",function(t,e){for(var r=Xn.call(Yn(this),t,e),n=wr(this,this.constructor),i=0,o=r.length,a=new(Kn(n))(o);o>i;)a[i]=r[i++];return a},o(function(){new Int8Array(1).slice()}));var Qn=Gt.some,Zn=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("some",function(t){return Qn(Zn(this),t,arguments.length>1?arguments[1]:void 0)});var ti=Hr.aTypedArray,ei=[].sort;(0,Hr.exportTypedArrayMethod)("sort",function(t){return ei.call(ti(this),t)});var ri=Hr.aTypedArray;(0,Hr.exportTypedArrayMethod)("subarray",function(t,e){var r=ri(this),n=r.length,i=ft(t,n);return new(wr(r,r.constructor))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,ct((void 0===e?n:ft(e,n))-i))});var ni=i.Int8Array,ii=Hr.aTypedArray,oi=Hr.exportTypedArrayMethod,ai=[].toLocaleString,ui=[].slice,si=!!ni&&o(function(){ai.call(new ni(1))});oi("toLocaleString",function(){return ai.apply(si?ui.call(ii(this)):ii(this),arguments)},o(function(){return[1,2].toLocaleString()!=new ni([1,2]).toLocaleString()})||!o(function(){ni.prototype.toLocaleString.call([1,2])}));var ci=Hr.exportTypedArrayMethod,li=i.Uint8Array,hi=li&&li.prototype||{},fi=[].toString,pi=[].join;o(function(){fi.call({})})&&(fi=function(){return pi.call(this)});var yi=hi.toString!=fi;ci("toString",fi,yi);var di=function(t){return new Float32Array(t)},vi=function(t,e){var r=new Float32Array(t);if(e)for(var n=0;n<t;n++)r[n]=randomFloat$1(-e,e);else for(var i=0;i<t;i++)r[i]=.4*Math.random()-.2;return r},gi=function(){function t(){de(this,t)}return ge(t,null,[{key:"toTable",value:function(e){var r=e.reduce(function(t,e){return Object.assign(t,e)},{});return t.toHash(r)}},{key:"toTable2D",value:function(t){for(var e={},r=0,n=0;n<t.length;n++)for(var i=t[n],o=0;o<i.length;o++){var a=i[o];for(var u in a)a.hasOwnProperty(u)&&!e.hasOwnProperty(u)&&(e[u]=r++)}return e}},{key:"toInputTable",value:function(t){for(var e={},r=0,n=0;n<t.length;n++)for(var i in t[n].input)e.hasOwnProperty(i)||(e[i]=r++);return e}},{key:"toInputTable2D",value:function(t){for(var e={},r=0,n=0;n<t.length;n++)for(var i=t[n].input,o=0;o<i.length;o++){var a=i[o];for(var u in a)e.hasOwnProperty(u)||(e[u]=r++)}return e}},{key:"toOutputTable",value:function(t){for(var e={},r=0,n=0;n<t.length;n++)for(var i in t[n].output)e.hasOwnProperty(i)||(e[i]=r++);return e}},{key:"toOutputTable2D",value:function(t){for(var e={},r=0,n=0;n<t.length;n++)for(var i=t[n].output,o=0;o<i.length;o++){var a=i[o];for(var u in a)e.hasOwnProperty(u)||(e[u]=r++)}return e}},{key:"toHash",value:function(t){var e={},r=0;for(var n in t)e[n]=r++;return e}},{key:"toArray",value:function(t,e,r){var n=new Float32Array(r);for(var i in t)n[t[i]]=e.hasOwnProperty(i)?e[i]:0;return n}},{key:"toArrayShort",value:function(t,e){var r=[];for(var n in t){if(!e.hasOwnProperty(n))break;r[t[n]]=e[n]}return Float32Array.from(r)}},{key:"toArrays",value:function(t,e,r){for(var n=[],i=0;i<e.length;i++)n.push(this.toArray(t,e[i],r));return n}},{key:"toObject",value:function(t,e){var r={};for(var n in t)r[n]=e[t[n]];return r}},{key:"toObjectPartial",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i={},o=0;for(var a in t)r>0&&o++<r||n>0&&o++>=n||(i[a]=e[t[a]-r]);return i}},{key:"lookupFromArray",value:function(t){for(var e={},r=0,n=t.length;n-- >0;)e[t[n]]=r++;return e}},{key:"dataShape",value:function(t){var e,r=[];for(t.input?(r.push("datum"),t=t.input):Array.isArray(t)&&(t[0].input?(r.push("array","datum"),t=t[0].input):(r.push("array"),t=t[0]));t;){for(e in t)break;if(!t.hasOwnProperty(e))break;if(Array.isArray(t)||t.buffer instanceof ArrayBuffer)r.push("array"),t=t[e];else{if("object"!==ye(t))throw new Error("unhandled signature");r.push("object"),t=t[e]}}return r.push(ye(t)),r}},{key:"addKeys",value:function(t,e){if(!Array.isArray(t)){e=e||{};var r=Object.keys(e).length;for(var n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)||(e[n]=r++));return e}}}]),t}(),mi={FeedForward:function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};de(this,t),this.layers=null,this.inputLayer=null,this.hiddenLayers=null,this.outputLayer=null,this.praxisOpts=null,this.praxis=null,Object.assign(this,this.constructor.defaults,e),this.trainOpts={},this._updateTrainingOptions(we(we({},this.constructor.trainDefaults),e)),Object.assign(this,this.constructor.structure),this._inputLayer=null,this._hiddenLayers=null,this._outputLayer=null}return ge(t,[{key:"_setLogMethod",value:function(t){this.trainOpts.log="function"==typeof t?t:!!t&&console.log}},{key:"_updateTrainingOptions",value:function(t){var e=this;Object.keys(this.constructor.trainDefaults).forEach(function(r){e.trainOpts[r]=t.hasOwnProperty(r)?t[r]:e.trainOpts[r]}),this.constructor._validateTrainingOptions(this.trainOpts),this._setLogMethod(t.log||this.trainOpts.log),this.trainOpts.callback&&this.trainOpts.callbackPeriod!==this.trainOpts.errorCheckInterval&&console.warn("options.callbackPeriod with value of ".concat(this.trainOpts.callbackPeriod," does not match options.errorCheckInterval with value of ").concat(this.trainOpts.errorCheckInterval,", if logging error, it will repeat.  These values may need to match"))}}],[{key:"_validateTrainingOptions",value:function(e){var r={iterations:function(t){return"number"==typeof t&&t>0},errorThresh:function(t){return"number"==typeof t&&t>0&&t<1},log:function(t){return"function"==typeof t||"boolean"==typeof t},logPeriod:function(t){return"number"==typeof t&&t>0},learningRate:function(t){return"number"==typeof t&&t>0&&t<1},callback:function(t){return"function"==typeof t||null===t},callbackPeriod:function(t){return"number"==typeof t&&t>0},timeout:function(t){return"number"==typeof t&&t>0}};Object.keys(t.trainDefaults).forEach(function(t){if(r.hasOwnProperty(t)&&!r[t](e[t]))throw new Error("[".concat(t,", ").concat(e[t],"] is out of normal training range, your network will probably not train."))})}},{key:"trainDefaults",get:function(){return{iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,learningRate:.3,callback:null,callbackPeriod:10,errorCheckInterval:100,reinforce:!1}}},{key:"defaults",get:function(){return{learningRate:.3,binaryThresh:.5,hiddenLayers:null,inputLayer:null,outputLayer:null,praxisOpts:null,praxis:function(t,e){return praxis.momentumRootMeanSquaredPropagation(we({},t),t.praxisOpts||e)}}}},{key:"structure",get:function(){return{layers:null,_inputLayer:null,_outputLayer:null,_model:null}}}]),ge(t,[{key:"_connectLayers",value:function(){var t=[];this._inputLayer=this.inputLayer();var e=this._connectHiddenLayers(this._inputLayer);this._outputLayer=this.outputLayer(e[e.length-1],e.length),t.push(this._inputLayer),t.push.apply(t,_toConsumableArray(e)),t.push(this._outputLayer),this.layers=flattenLayers(t)}},{key:"_connectHiddenLayers",value:function(t){this._hiddenLayers=[];for(var e=[],r=0;r<this.hiddenLayers.length;r++){var n=this.hiddenLayers[r](t,r);e.push(n),this._hiddenLayers.push(n),t=n}return e}},{key:"initialize",value:function(){this._connectLayers(),this.initializeLayers(this.layers),this._model=this.layers.filter(function(t){return t instanceof Model$4})}},{key:"initializeLayers",value:function(t){for(var e=0;e<t.length;e++){var r=t[e];r.setupKernels(!0),r instanceof Model$4&&r.hasOwnProperty("praxis")&&null===r.praxis&&(r.praxis=this.praxis(r,r.praxisOpts||this.praxisOpts),r.praxis.setupKernels())}var n=t[t.length-1];this.meanSquaredError=new MeanSquaredError$1({width:n.width,height:n.height})}},{key:"run",value:function(t){this.inputLookup&&(t=gi.toArray(this.inputLookup,t));var e=this.runInput(t);return e.toArray&&(e=e.toArray()),this.outputLookup&&(e=gi.toHash(this.outputLookup,e)),e}},{key:"runInput",value:function(t){this.layers[0].predict(t);for(var e=1;e<this.layers.length;e++)this.layers[e].predict();return this.layers[this.layers.length-1].weights}},{key:"train",value:function(t){var e,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this._prepTraining(t,n);for(t=i.data,e=i.status,r=i.endTime;this._trainingTick(t,e,r););return e}},{key:"_trainingTick",value:function(t,e,r){return!(e.iterations>=this.trainOpts.iterations||e.error<=this.trainOpts.errorThresh||Date.now()>=r)&&(this.trainOpts.log&&e.iterations%this.trainOpts.logPeriod==0?(e.error=this._calculateTrainingError(t),this.trainOpts.log("iterations: ".concat(e.iterations,", training error: ").concat(e.error))):e.iterations%this.trainOpts.errorCheckInterval==0?e.error=this._calculateTrainingError(t):this._trainPatterns(t),this.trainOpts.callback&&e.iterations%this.trainOpts.callbackPeriod==0&&this.trainOpts.callback(Object.assign(e)),e.iterations++,!0)}},{key:"_prepTraining",value:function(t,e){this._updateTrainingOptions(e);var r=this.formatData(t),n=Date.now()+this.trainOpts.timeout;return this.verifyIsInitialized(),{data:this.transferData(r),status:{error:1,iterations:0},endTime:n}}},{key:"verifyIsInitialized",value:function(){this._model||this.initialize()}},{key:"_calculateTrainingError",value:function(t){for(var e=new Float32Array([0]),r=0;r<t.length;++r){var n=e,i=this._trainPattern(t[r].input,t[r].output,!0);e=this.meanSquaredError.add(e,i),release$h(i),release$h(n)}var o=this.meanSquaredError.divide(t.length,e);if(release$h(e),o.toArray){var a=o.toArray();return release$h(o),a[0]}return o[0]}},{key:"_trainPatterns",value:function(t){for(var e=0;e<t.length;++e)this._trainPattern(t[e].input,t[e].output,!1)}},{key:"_trainPattern",value:function(t,e,r){return this.runInput(t),this._calculateDeltas(e),this.adjustWeights(),r?this.meanSquaredError.calculate(this._outputLayer.errors):null}},{key:"_calculateDeltas",value:function(t){for(var e=this.layers.length-1;e>-1;e--)this.layers[e].compare(t)}},{key:"adjustWeights",value:function(){for(var t=this._model,e=0;e<t.length;e++)t[e].learn(null,null,this.trainOpts.learningRate)}},{key:"formatData",value:function(t){var e=this;if(!Array.isArray(t)){var r=[];r.push(t),t=r}var n=t[0].input;Array.isArray(n)||n instanceof Float32Array||(this.inputLookup||(this.inputLookup=gi.buildLookup(t.map(function(t){return t.input}))),t=t.map(function(t){var r=gi.toArray(e.inputLookup,t.input);return we(we({},t),{},{input:r})},this));var i=t[0].output;return Array.isArray(i)||i instanceof Float32Array||(this.outputLookup||(this.outputLookup=gi.buildLookup(t.map(function(t){return t.output}))),t=t.map(function(t){var r=gi.toArray(e.outputLookup,t.output);return we(we({},t),{},{output:r})},this)),t}},{key:"transferData",value:function(t){for(var e=new Array(t.length),r=makeKernel$l(function(t){return t[this.thread.x]},{output:[t[0].input.length],immutable:!0}),n=makeKernel$l(function(t){return t[this.thread.x]},{output:[t[0].output.length],immutable:!0}),i=0;i<t.length;i++){var o=t[i];e[i]={input:r(o.input),output:n(o.output)}}return e}},{key:"test",value:function(){throw new Error("".concat(this.constructor.name,"-test is not yet implemented"))}},{key:"toJSON",value:function(){this.layers||this.initialize();for(var t=[],e=0;e<this.layers.length;e++){var r=this.layers[e],n=r.toJSON();r.hasOwnProperty("inputLayer")?n.inputLayerIndex=this.layers.indexOf(r.inputLayer):r.hasOwnProperty("inputLayer1")&&r.hasOwnProperty("inputLayer2")&&(n.inputLayer1Index=this.layers.indexOf(r.inputLayer1),n.inputLayer2Index=this.layers.indexOf(r.inputLayer2)),t.push(n)}return{type:this.constructor.name,sizes:[this._inputLayer.height].concat(this._hiddenLayers.map(function(t){return t.height})).concat([this._outputLayer.height]),layers:t}}},{key:"toFunction",value:function(){throw new Error("".concat(this.constructor.name,"-toFunction is not yet implemented"))}},{key:"createTrainStream",value:function(){throw new Error("".concat(this.constructor.name,"-createTrainStream is not yet implemented"))}}],[{key:"fromJSON",value:function(e,r){var n=e.layers,i=[],o=layerFromJson(n[0])||r(n[0]);i.push(o);for(var a=1;a<n.length;a++){var u=n[a];if(u.hasOwnProperty("inputLayerIndex")){var s=i[u.inputLayerIndex];i.push(layerFromJson(u,s)||r(u,s))}else{if(!u.hasOwnProperty("inputLayer1Index"))throw new Error("Cannot create network from provided JOSN. inputLayer1Index not defined.");if(!u.hasOwnProperty("inputLayer2Index"))throw new Error("Cannot create network from provided JOSN. inputLayer2Index not defined.");var c=i[u.inputLayer1Index],l=i[u.inputLayer2Index];if(void 0===c)throw new Error("Cannot create network from provided JOSN. layer of index ".concat(u.inputLayer1Index," not found."));if(void 0===l)throw new Error("Cannot create network from provided JOSN. layer of index ".concat(u.inputLayer2Index," not found."));i.push(layerFromJson(u,o)||r(u,c,l))}}var h=new t(e);return h.layers=i,h}}]),t}()},bi=[].join,wi=y!=Object,ki=Yt("join",",");Et({target:"Array",proto:!0,forced:wi||!ki},{join:function(t){return bi.call(v(this),void 0===t?",":t)}});var Oi,Li,Ai,Ti,_i=i.Promise,Si=function(t){var e,r;this.promise=new t(function(t,n){if(void 0!==e||void 0!==r)throw TypeError("Bad Promise constructor");e=t,r=n}),this.resolve=Wt(e),this.reject=Wt(r)},Ei={f:function(t){return new Si(t)}},Pi=function(t,e){if(_(t),g(e)&&e.constructor===t)return e;var r=Ei.f(t);return(0,r.resolve)(e),r.promise},ji=Ct("species"),xi="Promise",Ii=tt.get,Mi=tt.set,Ri=tt.getterFor(xi),Di=_i,Ci=(i.document,i.process),Fi=it("fetch"),zi=Ei.f,Ni=zi,Bi="process"==f(Ci),Ui=_t(xi,function(){if(!(C(Di)!==String(Di))){if(66===Jt)return!0;if(!Bi&&"function"!=typeof PromiseRejectionEvent)return!0}if(Jt>=51&&/native code/.test(Di))return!1;var t=Di.resolve(1),e=function(t){t(function(){},function(){})};return(t.constructor={})[ji]=e,!(t.then(function(){})instanceof e)}),$i=Ui||!Cr(function(t){Di.all(t).catch(function(){})});Ui&&(Di=function(t){ur(this,Di,xi),Wt(t),Oi.call(this);var e=Ii(this);try{t(bind(internalResolve,this,e),bind(internalReject,this,e))}catch(t){internalReject(this,e,t)}},(Oi=function(t){Mi(this,{type:xi,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=ar(Di.prototype,{then:function(t,e){var r=Ri(this),n=zi(wr(this,Di));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=Bi?Ci.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&notify$1(this,r,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),Li=function(){var t=new Oi,e=Ii(t);this.promise=t,this.resolve=bind(internalResolve,t,e),this.reject=bind(internalReject,t,e)},Ei.f=zi=function(t){return t===Di||t===Ai?new Li(t):Ni(t)},"function"==typeof _i&&(Ti=_i.prototype.then,et(_i.prototype,"then",function(t,e){var r=this;return new Di(function(t,e){Ti.call(r,t,e)}).then(t,e)},{unsafe:!0}),"function"==typeof Fi&&Et({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return Pi(Di,Fi.apply(i,arguments))}}))),Et({global:!0,wrap:!0,forced:Ui},{Promise:Di}),Ve(Di,xi,!1),Qr(xi),Ai=it(xi),Et({target:xi,stat:!0,forced:Ui},{reject:function(t){var e=zi(this);return e.reject.call(void 0,t),e.promise}}),Et({target:xi,stat:!0,forced:Ui},{resolve:function(t){return Pi(this,t)}}),Et({target:xi,stat:!0,forced:$i},{all:function(t){var e=this,r=zi(e),n=r.resolve,i=r.reject,o=perform(function(){var r=Wt(e.resolve),o=[],a=0,u=1;iterate_1(t,function(t){var s=a++,c=!1;o.push(void 0),u++,r.call(e,t).then(function(t){c||(c=!0,o[s]=t,--u||n(o))},i)}),--u||n(o)});return o.error&&i(o.value),r.promise},race:function(t){var e=this,r=zi(e),n=r.reject,i=perform(function(){var i=Wt(e.resolve);iterate_1(t,function(t){i.call(e,t).then(r.resolve,n)})});return i.error&&n(i.value),r.promise}});var Ji=r(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.thaw=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new a(t,e)};var i=!1,o=[],a=function(){function t(e){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var u=r({},this.constructor.defaultSettings,a),s=u.each,c=u.done;this.items=e,this.i=0,this.options=a;var l=this.tick=function(){if(!(n.i<0||(n.timeout=setTimeout(l,0),i))){var t=e[n.i];if(n.i>=e.length)return null!==c&&(i=!0,c(t,n.i),i=!1),n.i=-1,void clearTimeout(n.timeout);null!==s?(i=!0,s(t,n.i),i=!1):void 0!==t&&t(),n.i++}};o.push(this),a.delay||l()}return n(t,null,[{key:"stopAll",value:function(){for(var t=0;t<o.length;t++)o[t].stop()}},{key:"defaultSettings",get:function(){return{each:null,done:null}}},{key:"isThawing",get:function(){return i}}]),n(t,[{key:"makeReady",value:function(){return this.i<0&&(this.i=this.items.length,!0)}},{key:"add",value:function(t){var e=this.makeReady();return this.items.push(t),e&&this.tick(),this}},{key:"insert",value:function(t){var e=this.makeReady();return this.items.splice(this.i,0,t),e&&this.tick(),this}},{key:"addArray",value:function(t){var e=this.makeReady();return this.items=this.items.concat(t),e&&this.tick(),this}},{key:"insertArray",value:function(t){var e=this.makeReady(),r=this.items,n=t,i=this.items.splice(this.i,this.items.length-this.i+1);return this.items=r.concat(n,i),e&&this.tick(),this}},{key:"stop",value:function(){return this.i=-1,clearTimeout(this.timeout),this.options.done&&this.options.done(),this}}]),t}();e.default=a});e(Ji);Ji.thaw;e(r(function(t,e){}));var Vi=r(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Block=void 0});e(Vi);Vi.Block,c.f;var Wi=function(t,e){for(var r=[];t<e;t++)r.push(t);return r},Hi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};de(this,t),Object.assign(this,this.constructor.defaults,e),this.trainOpts={},this.updateTrainingOptions(we(we({},this.constructor.trainDefaults),e)),this.sizes=null,this.outputLayer=null,this.biases=null,this.weights=null,this.outputs=null,this.deltas=null,this.changes=null,this.errors=null,this.errorCheckInterval=1,this.constructor.prototype.hasOwnProperty("runInput")||(this.runInput=null),this.constructor.prototype.hasOwnProperty("calculateDeltas")||(this.calculateDeltas=null),this.inputLookup=null,this.inputLookupLength=null,this.outputLookup=null,this.outputLookupLength=null,e.inputSize&&e.hiddenLayers&&e.outputSize&&(this.sizes=[e.inputSize].concat(e.hiddenLayers).concat([e.outputSize]))}return ge(t,null,[{key:"trainDefaults",get:function(){return{iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,learningRate:.3,momentum:.1,callback:null,callbackPeriod:10,timeout:1/0,praxis:null,beta1:.9,beta2:.999,epsilon:1e-8}}},{key:"defaults",get:function(){return{leakyReluAlpha:.01,binaryThresh:.5,hiddenLayers:null,activation:"sigmoid"}}}]),ge(t,[{key:"initialize",value:function(){if(!this.sizes)throw new Error("Sizes must be set before initializing");this.outputLayer=this.sizes.length-1,this.biases=[],this.weights=[],this.outputs=[],this.deltas=[],this.changes=[],this.errors=[];for(var t=0;t<=this.outputLayer;t++){var e=this.sizes[t];if(this.deltas[t]=di(e),this.errors[t]=di(e),this.outputs[t]=di(e),t>0){this.biases[t]=vi(e),this.weights[t]=new Array(e),this.changes[t]=new Array(e);for(var r=0;r<e;r++){var n=this.sizes[t-1];this.weights[t][r]=vi(n),this.changes[t][r]=di(n)}}}this.setActivation(),"adam"===this.trainOpts.praxis&&this._setupAdam()}},{key:"setActivation",value:function(t){switch(this.activation=t||this.activation,this.activation){case"sigmoid":this.runInput=this.runInput||this._runInputSigmoid,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasSigmoid;break;case"relu":this.runInput=this.runInput||this._runInputRelu,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasRelu;break;case"leaky-relu":this.runInput=this.runInput||this._runInputLeakyRelu,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasLeakyRelu;break;case"tanh":this.runInput=this.runInput||this._runInputTanh,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasTanh;break;default:throw new Error("Unknown activation ".concat(this.activation,". Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'"))}}},{key:"run",value:function(t){if(!this.isRunnable)return null;this.inputLookup&&(t=gi.toArray(this.inputLookup,t,this.inputLookupLength));var e=this.runInput(t).slice(0);return this.outputLookup&&(e=gi.toObject(this.outputLookup,e)),e}},{key:"_runInputSigmoid",value:function(t){this.outputs[0]=t;for(var e=null,r=1;r<=this.outputLayer;r++){for(var n=this.sizes[r],i=this.weights[r],o=this.biases[r],a=this.outputs[r],u=0;u<n;u++){for(var s=i[u],c=o[u],l=0;l<s.length;l++)c+=s[l]*t[l];a[u]=1/(1+Math.exp(-c))}e=t=this.outputs[r]}return e}},{key:"_runInputRelu",value:function(t){this.outputs[0]=t;for(var e=null,r=1;r<=this.outputLayer;r++){for(var n=this.sizes[r],i=this.weights[r],o=this.biases[r],a=this.outputs[r],u=0;u<n;u++){for(var s=i[u],c=o[u],l=0;l<s.length;l++)c+=s[l]*t[l];a[u]=c<0?0:c}e=t=a}return e}},{key:"_runInputLeakyRelu",value:function(t){this.outputs[0]=t;for(var e=this.leakyReluAlpha,r=null,n=1;n<=this.outputLayer;n++){for(var i=this.sizes[n],o=this.weights[n],a=this.biases[n],u=this.outputs[n],s=0;s<i;s++){for(var c=o[s],l=a[s],h=0;h<c.length;h++)l+=c[h]*t[h];u[s]=l<0?0:e*l}r=t=u}return r}},{key:"_runInputTanh",value:function(t){this.outputs[0]=t;for(var e=null,r=1;r<=this.outputLayer;r++){for(var n=this.sizes[r],i=this.weights[r],o=this.biases[r],a=this.outputs[r],u=0;u<n;u++){for(var s=i[u],c=o[u],l=0;l<s.length;l++)c+=s[l]*t[l];a[u]=Math.tanh(c)}e=t=a}return e}},{key:"verifyIsInitialized",value:function(t){var e=this;this.sizes||(this.sizes=[],this.sizes.push(t[0].input.length),this.hiddenLayers?this.hiddenLayers.forEach(function(t){e.sizes.push(t)}):this.sizes.push(Math.max(3,Math.floor(t[0].input.length/2))),this.sizes.push(t[0].output.length),this.initialize())}},{key:"updateTrainingOptions",value:function(t){var e=this.constructor.trainDefaults;for(var r in e)e.hasOwnProperty(r)&&(this.trainOpts[r]=t.hasOwnProperty(r)?t[r]:e[r]);this.validateTrainingOptions(this.trainOpts),this.setLogMethod(t.log||this.trainOpts.log),this.activation=t.activation||this.activation}},{key:"validateTrainingOptions",value:function(t){var e={iterations:function(t){return"number"==typeof t&&t>0},errorThresh:function(t){return"number"==typeof t&&t>0&&t<1},log:function(t){return"function"==typeof t||"boolean"==typeof t},logPeriod:function(t){return"number"==typeof t&&t>0},learningRate:function(t){return"number"==typeof t&&t>0&&t<1},momentum:function(t){return"number"==typeof t&&t>0&&t<1},callback:function(t){return"function"==typeof t||null===t},callbackPeriod:function(t){return"number"==typeof t&&t>0},timeout:function(t){return"number"==typeof t&&t>0}};for(var r in e)if(e.hasOwnProperty(r)&&t.hasOwnProperty(r)&&!e[r](t[r]))throw new Error("[".concat(r,", ").concat(t[r],"] is out of normal training range, your network will probably not train."))}},{key:"getTrainOptsJSON",value:function(){var t=this;return Object.keys(this.constructor.trainDefaults).reduce(function(e,r){return"timeout"===r&&t.trainOpts[r]===1/0?e:"callback"===r?e:(t.trainOpts[r]&&(e[r]=t.trainOpts[r]),"log"===r&&(e.log="function"==typeof e.log),e)},{})}},{key:"setLogMethod",value:function(t){this.trainOpts.log="function"==typeof t?t:!!t&&this.logTrainingStatus}},{key:"logTrainingStatus",value:function(t){console.log("iterations: ".concat(t.iterations,", training error: ").concat(t.error))}},{key:"calculateTrainingError",value:function(t){for(var e=0,r=0;r<t.length;++r)e+=this.trainPattern(t[r],!0);return e/t.length}},{key:"trainPatterns",value:function(t){for(var e=0;e<t.length;++e)this.trainPattern(t[e])}},{key:"trainingTick",value:function(t,e,r){var n=this.trainOpts,i=n.callback,o=n.callbackPeriod,a=n.errorThresh,u=n.iterations,s=n.log,c=n.logPeriod;return!(e.iterations>=u||e.error<=a||Date.now()>=r)&&(e.iterations++,s&&e.iterations%c==0?(e.error=this.calculateTrainingError(t),s(e)):e.iterations%this.errorCheckInterval==0?e.error=this.calculateTrainingError(t):this.trainPatterns(t),i&&e.iterations%o==0&&i({iterations:e.iterations,error:e.error}),!0)}},{key:"prepTraining",value:function(t,e){this.updateTrainingOptions(e),t=this.formatData(t);var r=Date.now()+this.trainOpts.timeout;return this.verifyIsInitialized(t),{data:t,status:{error:1,iterations:0},endTime:r}}},{key:"train",value:function(t){var e,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.prepTraining(t,n);for(t=i.data,e=i.status,r=i.endTime;this.trainingTick(t,e,r););return e}},{key:"trainAsync",value:function(t){var e,r,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.prepTraining(t,i);return t=o.data,e=o.status,r=o.endTime,new Promise(function(i,o){try{var a=new Thaw(new Array(n.trainOpts.iterations),{delay:!0,each:function(){return n.trainingTick(t,e,r)||a.stop()},done:function(){return i(e)}});a.tick()}catch(t){o(new Error({trainError:t,status:e}))}})}},{key:"trainPattern",value:function(t,e){return this.runInput(t.input),this.calculateDeltas(t.output),this.adjustWeights(),e?mse(this.errors[this.outputLayer]):null}},{key:"_calculateDeltasSigmoid",value:function(t){for(var e=this.outputLayer;e>=0;e--)for(var r=this.sizes[e],n=this.outputs[e],i=this.errors[e],o=this.deltas[e],a=this.weights[e+1],u=0;u<r;u++){var s=n[u],c=0;if(e===this.outputLayer)c=t[u]-s;else for(var l=this.deltas[e+1],h=0;h<l.length;h++)c+=l[h]*a[h][u];i[u]=c,o[u]=c*s*(1-s)}}},{key:"_calculateDeltasRelu",value:function(t){for(var e=this.outputLayer;e>=0;e--)for(var r=this.sizes[e],n=this.outputs[e],i=this.weights[e+1],o=this.deltas[e+1],a=this.errors[e],u=this.deltas[e],s=0;s<r;s++){var c=n[s],l=0;if(e===this.outputLayer)l=t[s]-c;else for(var h=0;h<o.length;h++)l+=o[h]*i[h][s];a[s]=l,u[s]=c>0?l:0}}},{key:"_calculateDeltasLeakyRelu",value:function(t){for(var e=this.leakyReluAlpha,r=this.outputLayer;r>=0;r--)for(var n=this.sizes[r],i=this.outputs[r],o=this.deltas[r+1],a=this.weights[r+1],u=this.errors[r],s=this.deltas[r],c=0;c<n;c++){var l=i[c],h=0;if(r===this.outputLayer)h=t[c]-l;else for(var f=0;f<o.length;f++)h+=o[f]*a[f][c];u[c]=h,s[c]=l>0?h:e*h}}},{key:"_calculateDeltasTanh",value:function(t){for(var e=this.outputLayer;e>=0;e--)for(var r=this.sizes[e],n=this.outputs[e],i=this.deltas[e+1],o=this.weights[e+1],a=this.errors[e],u=this.deltas[e],s=0;s<r;s++){var c=n[s],l=0;if(e===this.outputLayer)l=t[s]-c;else for(var h=0;h<i.length;h++)l+=i[h]*o[h][s];a[s]=l,u[s]=(1-c*c)*l}}},{key:"adjustWeights",value:function(){for(var t=this.trainOpts,e=t.learningRate,r=t.momentum,n=1;n<=this.outputLayer;n++)for(var i=this.outputs[n-1],o=this.sizes[n],a=this.deltas[n],u=this.changes[n],s=this.weights[n],c=this.biases[n],l=0;l<o;l++){for(var h=a[l],f=0;f<i.length;f++){var p=u[l][f];p=e*h*i[f]+r*p,u[l][f]=p,s[l][f]+=p}c[l]+=e*h}}},{key:"_setupAdam",value:function(){this.biasChangesLow=[],this.biasChangesHigh=[],this.changesLow=[],this.changesHigh=[],this.iterations=0;for(var t=0;t<=this.outputLayer;t++){var e=this.sizes[t];if(t>0){this.biasChangesLow[t]=di(e),this.biasChangesHigh[t]=di(e),this.changesLow[t]=new Array(e),this.changesHigh[t]=new Array(e);for(var r=0;r<e;r++){var n=this.sizes[t-1];this.changesLow[t][r]=di(n),this.changesHigh[t][r]=di(n)}}}this.adjustWeights=this._adjustWeightsAdam}},{key:"_adjustWeightsAdam",value:function(){this.iterations++;for(var t=this.iterations,e=this.trainOpts,r=e.beta1,n=e.beta2,i=e.epsilon,o=e.learningRate,a=1;a<=this.outputLayer;a++)for(var u=this.outputs[a-1],s=this.sizes[a],c=this.deltas[a],l=this.changesLow[a],h=this.changesHigh[a],f=this.weights[a],p=this.biases[a],y=this.biasChangesLow[a],d=this.biasChangesHigh[a],v=0;v<s;v++){for(var g=c[v],m=0;m<u.length;m++){var b=g*u[m],w=l[v][m]*r+(1-r)*b,k=h[v][m]*n+(1-n)*b*b,O=w/(1-Math.pow(r,t)),L=k/(1-Math.pow(n,t));l[v][m]=w,h[v][m]=k,f[v][m]+=o*O/(Math.sqrt(L)+i)}var A=c[v],T=y[v]*r+(1-r)*A,_=d[v]*n+(1-n)*A*A,S=y[v]/(1-Math.pow(r,t)),E=d[v]/(1-Math.pow(n,t));y[v]=T,d[v]=_,p[v]+=o*S/(Math.sqrt(E)+i)}}},{key:"formatData",value:function(t){if(Array.isArray(t)||(t=[t]),!Array.isArray(t[0].input))if(this.inputLookup)this.inputLookupLength=Object.keys(this.inputLookup).length;else{var e=new lookupTable(t,"input");this.inputLookup=e.table,this.inputLookupLength=e.length}if(!Array.isArray(t[0].output))if(this.outputLookup)this.outputLookupLength=Object.keys(this.outputLookup).length;else{var r=new lookupTable(t,"output");this.outputLookup=r.table,this.outputLookupLength=r.length}if(void 0===this._formatInput&&(this._formatInput=getTypedArrayFn(t[0].input,this.inputLookup),this._formatOutput=getTypedArrayFn(t[0].output,this.outputLookup)),this._formatInput&&this._formatOutput){for(var n=[],i=0;i<t.length;i++)n.push({input:this._formatInput(t[i].input),output:this._formatOutput(t[i].output)});return n}if(this._formatInput){for(var o=[],a=0;a<t.length;a++)o.push({input:this._formatInput(t[a].input),output:t[a].output});return o}if(this._formatOutput){for(var u=[],s=0;s<t.length;s++)u.push({input:t[s].input,output:this._formatOutput(t[s].output)});return u}return t}},{key:"addFormat",value:function(t){this.inputLookup=gi.addKeys(t.input,this.inputLookup),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length),this.outputLookup=gi.addKeys(t.output,this.outputLookup),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length)}},{key:"test",value:function(t){var e=this,r=1===(t=this.formatData(t))[0].output.length,n=[],i=0;if(r){for(var o=0,a=0,u=0,s=0,c=function(r){var c=e.runInput(t[r].input),l=t[r].output,h=c[0]>e.binaryThresh?1:0,f=l[0];if(h!==f){var p=t[r];n.push({input:p.input,output:p.output,actual:h,expected:f})}0===h&&0===f?s++:1===h&&1===f?u++:0===h&&1===f?a++:1===h&&0===f&&o++,i+=mse(c.map(function(t,e){return l[e]-t}))},l=0;l<t.length;l++)c(l);return{error:i/t.length,misclasses:n,total:t.length,trueNeg:s,truePos:u,falseNeg:a,falsePos:o,precision:u>0?u/(u+o):0,recall:u>0?u/(u+a):0,accuracy:(s+u)/t.length}}for(var h=function(r){var o=e.runInput(t[r].input),a=t[r].output,u=o.indexOf(max$3(o)),s=a.indexOf(max$3(a));if(u!==s){var c=t[r];n.push({input:c.input,output:c.output,actual:u,expected:s})}i+=mse(o.map(function(t,e){return a[e]-t}))},f=0;f<t.length;f++)h(f);return{error:i/t.length,misclasses:n,total:t.length}}},{key:"toJSON",value:function(){null===this.sizes&&this.initialize();for(var t=[],e=0;e<=this.outputLayer;e++){t[e]={};var r=void 0;r=0===e&&this.inputLookup?Object.keys(this.inputLookup):this.outputLookup&&e===this.outputLayer?Object.keys(this.outputLookup):Wi(0,this.sizes[e]);for(var n=0;n<r.length;n++){var i=r[n];if(t[e][i]={},e>0)for(var o in t[e][i].bias=this.biases[e][n],t[e][i].weights={},t[e-1]){var a=o;1===e&&this.inputLookup&&(a=this.inputLookup[o]),t[e][i].weights[o]=this.weights[e][n][a]}}}return{sizes:this.sizes.slice(0),layers:t,outputLookup:null!==this.outputLookup,inputLookup:null!==this.inputLookup,activation:this.activation,trainOpts:this.getTrainOptsJSON()}}},{key:"fromJSON",value:function(t){Object.assign(this,this.constructor.defaults,t),this.sizes=t.sizes,this.initialize();for(var e=0;e<=this.outputLayer;e++){var r=t.layers[e];if(0!==e||r[0]&&!t.inputLookup?e!==this.outputLayer||r[0]&&!t.outputLookup||(this.outputLookup=gi.toHash(r)):(this.inputLookup=gi.toHash(r),this.inputLookupLength=Object.keys(this.inputLookup).length),e>0){var n=Object.keys(r);for(var i in this.sizes[e]=n.length,n)if(n.hasOwnProperty(i)){var o=n[i];this.biases[e][i]=r[o].bias,this.weights[e][i]=(a=r[o].weights,Array.isArray(a)?a:new Float32Array(Object.values(a)))}}}var a;return t.hasOwnProperty("trainOpts")&&this.updateTrainingOptions(t.trainOpts),this}},{key:"toFunction",value:function(t){var e=this.activation,r=this.leakyReluAlpha,n=!1;function i(t,o,a){if(0===o)return"string"==typeof a?"(input['".concat(a,"']||0)"):"(input[".concat(a,"]||0)");var u=t[o][a],s=["(",u.bias];for(var c in u.weights)u.weights[c]<0?s.push("".concat(u.weights[c],"*").concat(i(t,o-1,c))):s.push("+".concat(u.weights[c],"*").concat(i(t,o-1,c)));switch(s.push(")"),e){case"sigmoid":return"1/(1+1/Math.exp(".concat(s.join(""),"))");case"relu":return n=!0,"((v=".concat(s.join(""),")<0?0:v)");case"leaky-relu":return n=!0,"((v=".concat(s.join(""),")<0?0:").concat(r,"*v)");case"tanh":return"Math.tanh(".concat(s.join(""),")");default:throw new Error("Unknown activation ".concat(this.activation,". Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'"))}}var o,a=this.toJSON().layers,u=[];for(var s in a[a.length-1])u.push(i(a,a.length-1,s));o=this.outputLookup?"{".concat(Object.keys(this.outputLookup).map(function(t,e){return"'".concat(t,"':").concat(u[e])}),"}"):"[".concat(u.join(","),"]");var c="".concat(n?"var v;":"","return ").concat(o,";");return new Function("input",t?t(c):c)}},{key:"isRunnable",get:function(){var t=this;if(!this.runInput)return console.error("Activation function has not been initialized, did you run train()?"),!1;var e=["sizes","outputLayer","biases","weights","outputs","deltas","changes","errors"].filter(function(e){return null===t[e]});return!(e.length>0)||(console.error("Some settings have not been initialized correctly, did you run train()? Found issues with: ".concat(e.join(", "))),!1)}}]),t}();return r(function(t){var e={FeedForward:mi.FeedForward,NeuralNetwork:Hi};"undefined"!=typeof window&&(window.brain=e),t.exports=e})}),PointNG.prototype=function(){var t,e,r,n,i="https://cdn.pointng.io/networks/",o=["Unknown error","Permission denied by user","Position is not available","Request timed out"],a={continent:null,sub_region:null,country:null,country_id:0,capital:null,currency:null,phone_code:null,iso2:null,iso3:null,state:null,state_id:null,state_code:null,city:null,city_id:null,latitude:0,longitude:0,ready:null},u="pointng_script";async function s(e,r,n,i,o,a,u,c){if(c&&(t=c),el=document.getElementById(n),el){el.remove();const t=document.createElement("script");t.src=i,t.id=n,document.body.appendChild(t),t.onload=async function(){u&&await u(e,r,o,a,s)}}else{const t=document.createElement("script");t.src=i,t.id=n,document.body.appendChild(t),t.onload=async function(){u&&await u(e,r,o,a,s)}}}function c(r,n,o,s,c){var h=netJsonSub.sub_region,f=new brain.NeuralNetwork;f.fromJSON(h),f.toFunction();var d=y(f.run(p(r,n,5)));a.continent=d.split("&")[0],a.sub_region=d.split("&")[1].replace(/_/g," "),console.log(t),"continent"!=t&&t&&null!=t&&null!=t&&0!=t&&""!=t?"country"==t||"state"==t||"city"==t?c(r,n,u,i+"iso2/"+decodeURIComponent(a.sub_region).replace(/ /g,"_").toLowerCase()+"_iso2.js?api_key="+e,o,s,l):s(new Error("Unable to return location information due to invalid level-configuration.")):(a.ready=!0,o(a))}function l(r,n,o,s,c){if(netJson){var l=netJson[`${a.sub_region.replace(/ /g,"_").toLowerCase()+"_iso2"}`],f=new brain.NeuralNetwork;f.fromJSON(l),f.toFunction();var d=y(f.run(p(r,n,5)));a.country=d.split("&")[0].replace(/_/g," "),a.iso2=d.split("&")[1],a.iso3=d.split("&")[2],a.phone_code=d.split("&")[3],a.capital=d.split("&")[4],a.currency=d.split("&")[5],"country"==t?(a.ready=!0,o(a)):"state"==t||"city"==t?c(r,n,u,i+"state/"+decodeURIComponent(a.iso2).replace(/ /g,"_").toLowerCase()+"_state.js?api_key="+e,o,s,h):s(new Error("Unable to return location information due to invalid level-configuration."))}else s(new Error("Unable to return location information. Make sure you provided a valid API key."))}function h(r,n,o,s,c){var l=netJson[`${a.iso2.replace(/ /g,"_").toLowerCase()+"_state"}`],h=new brain.NeuralNetwork;h.fromJSON(l),h.toFunction();var d=y(h.run(p(r,n,5)));a.state=d.split("&")[0].replace(/_/g," "),"state"==t?(a.ready=!0,o(a)):c(r,n,u,i+"city/"+a.iso2.toLowerCase()+"_"+decodeURIComponent(a.state).replace(/ /g,"_").toLowerCase()+"_city.js?api_key="+e,o,s,f)}function f(t,e,r,n){var i=netJson[`${a.iso2.toLowerCase()+"_"+a.state.replace(/ /g,"_").toLowerCase()+"_city"}`],o=new brain.NeuralNetwork;o.fromJSON(i),o.toFunction();var u=y(o.run(p(t,e,5)));a.city=u.split("&")[0].replace(/_/g," "),a.latitude=parseFloat(u.split("&")[1]),a.longitude=parseFloat(u.split("&")[2]),a.sub_region&&a&&a.city?(a.ready=!0,r(a)):n(new Error("Unable to return location information"))}function p(t,e,r){var n={},i=function(t,e,r){for(var n="0123456789bcdefghjkmnpqrstuvwxyz",i={},o=0;o<n.length;o++)i[n.charAt(o)]=o;if("auto"===r){if("number"==typeof t||"number"==typeof e)throw new Error("string notation required for auto precision.");var a=t.split(".")[1].length,u=e.split(".")[1].length,s=Math.max(a,u);r=[0,5,7,8,11,12,13,15,16,17,18][s]}else void 0===r&&(r=10);var c,l=[],h=0,f=0,p=0,y=90,d=-90,v=180,g=-180;for(;l.length<r;)if(f%2==0?e>(c=(v+g)/2)?(p=1+(p<<1),g=c):(p=0+(p<<1),v=c):t>(c=(y+d)/2)?(p=1+(p<<1),d=c):(p=0+(p<<1),y=c),f++,5===++h){var m=n[p];l.push(m),h=0,p=0}return l.join("")}(t,e,r),o=i.charAt(0),a=i.charAt(1),u=i.charAt(2),s=i.charAt(3),c=i.charAt(4),l=i.charAt(5);return n[`${"first_".concat(o)}`]=1,n[`${"second_".concat(a)}`]=1,n[`${"third_".concat(u)}`]=1,n[`${"fourth_".concat(s)}`]=1,n[`${"fifth_".concat(c)}`]=1,n[`${"sixth_".concat(l)}`]=1,n}function y(t){var e=[];for(var r in t)e.push([r,t[r]]);return e.sort(function(t,e){return e[1]-t[1]}),e[0][0]}function d(t,e,r,n){var i=document.querySelector(t),o=document.createElement(e);o.innerHTML=n,"head"!=t&&(o.className+=r),i.appendChild(o)}return{getLocation:function(r){t=r||this.config.level,e=this.config.api_key;var n=new Promise(function(t,r){navigator.geolocation.getCurrentPosition(async function(r){var n=await async function(t,r){return new Promise(function(n,o){s(t,r,u,i+"sub_region.js?api_key="+e,n,o,c)})}(r.coords.latitude,r.coords.longitude);t(n)},function(e){o[e.code],0!==e.code&&2!==e.code||e.message,t(a)})});return n.catch(t=>a),n},latLonLocate:function(r,n){return t=this.config.level,e=this.config.api_key,new Promise(function(t,o){s(r,n,u,i+"sub_region.js?api_key="+e,t,o,c)})},predictionData:a,userLocate:function(){document.getElementById("pointngForm").style.display="none",a.ready=!1;var t=document.getElementsByName("levels");if(!(document.getElementById("continent").checked||document.getElementById("country").checked||document.getElementById("state").checked||document.getElementById("city").checked))return console.log("not checked"),void(document.getElementById("warning").innerHTML="<p>Select at least one</p>");for(var e=0,r=t.length;e<r;e++)if(t[e].checked){console.log(t[e].value),this.getLocation(t[e].value);break}},openWidget:function(t){return new Promise(function(e,r){"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t),e("success")})},start:function(){r="left"==this.config.widgetPosition?"left":"right",n=this.config.privacyPolicyLink,d("head","style","",`.pointng-open-button{color:#fff;border-radius: 5px;box-shadow: 0 2px 6px 0 rgba(0,0,0,.4);margin: 20px;border:none;cursor:pointer;position:fixed;bottom:5px;${r}:5px;width:35px}.pointng-popup{display:none;position:fixed;bottom:70;${r}:15px;border:2px solid #f1f1f1;z-index:9;border-radius: 5px;font-family: system-ui;}.pointng-form-container{max-width:300px;padding-left:20px;padding-right:20px;padding-bottom:20px;padding-top:1px;background-color:#fff}.pointng-form-container textarea{width:100%;padding:15px;margin:5px 0 22px 0;border:none;background:#f1f1f1;resize:none;min-height:200px}.pointng-form-container textarea:focus{background-color:#ddd;outline:0}.pointng-form-container .btn{background-color:31b0d4;border-radius:5px;font-size:1.1em;color:#fff;padding:16px 20px;border:none;cursor:pointer;width:100%;margin-bottom:10px;opacity:.8}.pointng-form-container .cancel{background-color:red}.form-container .btn:hover,.pointng-open-button:hover{opacity:1}.pointng-link {text-decoration: none;}`);for(var t=document.querySelectorAll(".pointng-widget"),e=0;e<t.length;e++)t[e].setAttribute("id","pointng-widget"+e),d("#pointng-widget"+e,"div","",`<img class="pointng-open-button" src="https://cdn.pointng.io/pointng_widget.svg" alt="pointng" onclick="pointng.openForm()"><div class="pointng-popup" id="pointngForm"><div class="pointng-form-container"> <h3>pointNG location management</h3><p>Choose the level that you allow this website to use your location.</p><input type="radio" id="continent" name="levels" value="continent" checked> <label for="continent">Continent</label><br><input type="radio" id="country" name="levels" value="country"> <label for="country">Country</label><br><input type="radio" id="state" name="levels" value="state"><label for="state">State</label><br><input type="radio" id="city" name="levels" value="city"><label for="city">City</label><br><div id="warning"></div><br><button type="submit" id="locateMe" class="btn" onclick="pointng.userLocate()">Locate me</button><button type="submit" id="locateMe" class="btn" onclick="pointng.savePreferences()">Save my preferences</button><br><a class="pointng-link" href="${n}">Read how this site uses your location &raquo;</a></div></div>`)},openForm:function(){"block"==document.getElementById("pointngForm").style.display?document.getElementById("pointngForm").style.display="none":document.getElementById("pointngForm").style.display="block"},savePreferences:function(){document.getElementById("pointngForm").style.display="none",a.ready=!1;var e=document.getElementsByName("levels");if(!(document.getElementById("continent").checked||document.getElementById("country").checked||document.getElementById("state").checked||document.getElementById("city").checked))return console.log("not checked"),void(document.getElementById("warning").innerHTML="<p>Select at least one</p>");for(var r=0,n=e.length;r<n;r++)if(e[r].checked){console.log(e[r].value),this.currentLevel=e[r].value,this.config.level=e[r].value,t=e[r].value;break}}}}();

module.exports = {
    PointNG: PointNG
}